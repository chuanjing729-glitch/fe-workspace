# 测试验证清单

## 📋 测试目标

验证 Incremental Coverage Plugin 在 Webpack 4 环境下的功能完整性，确保：
1. ✅ 插件正确检测 webpack-dev-server 3.x 并使用 `before` API
2. ✅ 代码覆盖率统计准确
3. ✅ 报告生成正常
4. ✅ 所有测试场景都能触发覆盖率收集

---

## 🚀 启动测试

### 1. 环境准备

```bash
# 进入示例目录
cd packages/incremental-coverage-plugin/examples/webpack4-vue2

# 确认依赖已安装
npm ls webpack webpack-dev-server

# 应该看到：
# webpack@4.46.0
# webpack-dev-server@3.11.3
```

### 2. 启动开发服务器

```bash
npm run dev
```

### 3. 验证插件加载

**检查控制台输出**：

- [ ] `[IncrementalCoverage] 插件已初始化`
- [ ] `[IncrementalCoverage] Webpack 模式`
- [ ] `[IncrementalCoverage] 已注入到 babel-loader`
- [ ] `[IncrementalCoverage] 中间件已注册 (webpack-dev-server 3.x)` ✨ **关键**

**如果看到 `webpack-dev-server 3.x`，说明自动检测成功！🎉**

---

## 📊 功能测试场景

### 场景 A：基础演示（原有功能）

#### A1. 计数器功能

- [ ] 点击"增加"按钮 → 计数增加
- [ ] 点击"减少"按钮 → 计数减少
- [ ] 点击"重置"按钮 → 计数归零

**验证**：
- [ ] 右下角浮窗显示覆盖率数据
- [ ] 控制台输出：`[IncrementalCoverage] 📊 收到覆盖率数据`

#### A2. 任务列表功能

- [ ] 输入任务并按回车 → 任务添加
- [ ] 点击任务文本 → 标记完成/未完成
- [ ] 点击删除按钮 → 任务移除

**验证**：
- [ ] 覆盖率浮窗数据更新
- [ ] 5秒后生成报告到 `.coverage/latest.html`

---

### 场景 B：测试场景面板（新增功能）

切换到"测试场景"标签页，逐个测试以下场景：

#### B1. 基础函数测试

- [ ] 点击"测试加法" → 显示结果 "10 + 20 = 30"
- [ ] 点击"测试减法" → 显示结果 "50 - 30 = 20"
- [ ] 点击"测试评分" → 显示评分结果

**覆盖的代码**：
- `utils.js` - `add()`, `subtract()`, `getGrade()`

#### B2. 验证逻辑测试

- [ ] 点击"有效用户" → 显示 "✅ 用户验证通过"
- [ ] 点击"无效用户" → 显示错误信息
- [ ] 点击"无效邮箱" → 显示邮箱错误

**覆盖的代码**：
- `utils.js` - `validateUser()` 的所有分支

#### B3. 数组操作测试

- [ ] 点击"过滤偶数" → 显示偶数数组
- [ ] 点击"数组求和" → 显示求和结果
- [ ] 点击"斐波那契数列" → 显示数列

**覆盖的代码**：
- `utils.js` - `filterEvenNumbers()`, `sumArray()`, `fibonacci()`

#### B4. 类与对象测试

- [ ] 点击"计算器" → 显示计算结果
- [ ] 点击"深拷贝" → 显示克隆结果
- [ ] 点击"对象合并" → 显示合并结果

**覆盖的代码**：
- `utils.js` - `Calculator` 类, `deepClone()`, `mergeObjects()`

#### B5. 异常处理测试

- [ ] 点击"JSON 解析" → 显示解析结果
- [ ] 点击"除零错误" → 显示捕获的错误
- [ ] 点击"星期名称" → 显示星期列表

**覆盖的代码**：
- `utils.js` - `parseJSON()`, `getDayName()`, `Calculator.divide(0)`

---

## 🎯 覆盖率验证

### 预期覆盖率目标

| 文件 | 预期覆盖率 | 说明 |
|-----|-----------|------|
| `App.vue` | 70-80% | 主要组件逻辑 |
| `TestPanel.vue` | 80-90% | 测试面板组件 |
| `utils.js` | 85-95% | 工具函数模块 |
| **总体** | **80%+** | 整体目标 |

### 查看覆盖率报告

#### 方法 1：浏览器浮窗

- [ ] 右下角显示覆盖率浮窗
- [ ] 显示绿色（≥80%）、橙色（50-80%）或红色（<50%）
- [ ] 显示变更的行数

#### 方法 2：HTML 报告

```bash
# 等待 5 秒后
open .coverage/latest.html
```

**检查报告内容**：
- [ ] 显示增量覆盖率百分比
- [ ] 列出所有变更文件
- [ ] 标记已覆盖行（绿色）和未覆盖行（红色）

#### 方法 3：控制台日志

```
[IncrementalCoverage] 增量覆盖率: 85.00% (覆盖 34/40 行)
```

- [ ] 覆盖率 ≥ 80%
- [ ] 覆盖行数与总行数合理

---

## 🔍 边缘情况测试

### 测试 1：快速连续点击

- [ ] 快速连续点击多个按钮
- [ ] 验证覆盖率数据不丢失
- [ ] 验证不会重复生成报告（5秒防抖）

### 测试 2：切换标签页

- [ ] 在"基础演示"和"测试场景"之间切换
- [ ] 验证两个标签页的功能都正常
- [ ] 验证覆盖率数据持续累积

### 测试 3：页面刷新

- [ ] 执行一些操作后刷新页面
- [ ] 验证覆盖率数据重新开始收集
- [ ] 验证新报告生成

### 测试 4：浏览器控制台检查

打开浏览器开发者工具：

```javascript
// 检查覆盖率数据
console.log(window.__coverage__)

// 应该看到类似输出
{
  "/path/to/App.vue": { s: {...}, b: {...}, f: {...} },
  "/path/to/utils.js": { s: {...}, b: {...}, f: {...} }
}
```

- [ ] `window.__coverage__` 对象存在
- [ ] 包含所有测试过的文件
- [ ] 数据结构完整

---

## ✅ 成功标准

### 必须通过（P0）

- ✅ 插件正确检测到 webpack-dev-server 3.x
- ✅ 中间件注册成功
- ✅ 覆盖率数据正常收集
- ✅ HTML 报告正常生成
- ✅ 总体覆盖率 ≥ 50%

### 应该通过（P1）

- ✅ 所有13个测试场景都能执行
- ✅ 覆盖率浮窗正常显示
- ✅ 总体覆盖率 ≥ 80%
- ✅ 报告中包含所有测试过的文件

### 期望通过（P2）

- ✅ 快速点击不会导致数据丢失
- ✅ 页面切换不影响功能
- ✅ 报告内容准确详细

---

## 🐛 常见问题排查

### 问题 1：覆盖率始终为 0

**检查**：
1. 浏览器控制台输入 `window.__coverage__`，是否有数据？
2. 确认 babel-loader 是否正确注入插桩代码
3. 检查 `include` 配置是否匹配文件路径

### 问题 2：中间件注册失败

**检查**：
1. 确认 webpack-dev-server 版本是 3.x
2. 查看控制台是否有错误信息
3. 确认 webpack 配置没有语法错误

### 问题 3：报告未生成

**检查**：
1. 是否等待了足够的时间（5秒）
2. `.coverage/` 目录是否存在
3. 查看控制台是否有报告生成的日志

---

## 📝 测试报告模板

```markdown
## 测试环境
- Node.js 版本：
- Webpack 版本：4.46.0
- webpack-dev-server 版本：3.11.3
- 测试日期：

## 测试结果

### 插件加载
- [ ] 通过 / [ ] 失败
- 日志输出：

### 功能测试
- 基础演示：[ ] 通过 / [ ] 失败
- 测试场景：[ ] 通过 / [ ] 失败

### 覆盖率
- 总体覆盖率：__%
- App.vue：__%
- TestPanel.vue：__%  
- utils.js：__%

### 问题记录
1. 
2. 

### 截图
- 控制台日志：
- 覆盖率浮窗：
- HTML 报告：
```

---

## 🎉 测试完成

所有测试通过后，您已成功验证：

1. ✅ Webpack 4 + webpack-dev-server 3.x 完全支持
2. ✅ 自动版本检测功能正常
3. ✅ 覆盖率统计准确
4. ✅ 13+ 个测试场景全部可用

**可以进行下一步：准备发布 v2.0.1！** 🚀
