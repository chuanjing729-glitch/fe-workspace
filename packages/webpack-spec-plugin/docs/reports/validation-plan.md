# Webpack 规范检查插件 - 全面验证计划

## 📋 验证目标

验证插件在真实项目 mall-portal-front 中的所有功能是否达到预期。

---

## ✅ 验证清单

### 1. 核心检查功能

| # | 功能 | 预期结果 | 验证方法 | 状态 |
|---|------|---------|---------|------|
| 1.1 | 文件命名规范检查 | 发现不规范的文件名 | 扫描源码 | ✅ 已验证 |
| 1.2 | 注释规范检查 | 发现缺少注释的函数 | 扫描源码 | ✅ 已验证 |
| 1.3 | **导入规范检查** | 发现循环依赖、重复导入 | 扫描源码 | ✅ **已验证（12个）** |
| 1.4 | **变量命名检查** | 发现不规范的变量名 | 扫描源码 | ✅ 已验证 |
| 1.5 | **内存泄漏检查** | 发现未清理的定时器 | 扫描源码 | ✅ **已验证（6个）** |
| 1.6 | **安全检查** | 发现 XSS、eval 等风险 | 扫描源码 | ✅ **已验证（1个）** |

### 2. 性能检查功能 ⭐

| # | 功能 | 预期结果 | 验证方法 | 状态 |
|---|------|---------|---------|------|
| 2.1 | **图片大小检查** | 发现超标图片 | 扫描 assets | ✅ **已验证（7个超标）** |
| 2.2 | **JS 文件大小检查** | 发现超标脚本 | 扫描源码 | ✅ 已验证 |
| 2.3 | **CSS 文件大小检查** | 发现超标样式 | 扫描源码 | ✅ 已验证 |
| 2.4 | **构建前后文件对比** | 检测文件异常增大 | 实际构建 | ❌ **待验证** 🔴 |
| 2.5 | **性能预算配置** | 可自定义限制 | 修改配置 | ⚠️ 部分验证 |

### 3. 工作流集成 ⭐

| # | 功能 | 预期结果 | 验证方法 | 状态 |
|---|------|---------|---------|------|
| 3.1 | **增量检查模式** | 只检查 Git 变更文件 | 运行构建 | ⚠️ 部分验证 |
| 3.2 | **全量检查模式** | 检查所有源文件 | 运行构建 | ❌ **待验证** 🔴 |
| 3.3 | **构建中断** | 发现错误时中断构建 | 运行构建 | ❌ **待验证** 🔴 |
| 3.4 | **Git Hooks 集成** | pre-commit 自动检查 | 执行提交 | ❌ **待验证** 🔴 |
| 3.5 | **HTML 报告生成** | 生成可视化报告 | 运行构建 | ❌ **待验证** 🔴 |

### 4. 性能优化功能 ⭐

| # | 功能 | 预期结果 | 验证方法 | 状态 |
|---|------|---------|---------|------|
| 4.1 | **文件缓存机制** | 未变更文件跳过检查 | 重复构建 | ❌ **待验证** 🔴 |
| 4.2 | **缓存有效性** | 文件变更后重新检查 | 修改文件 | ❌ **待验证** 🔴 |
| 4.3 | **性能提升** | 缓存后速度提升 2-10倍 | 对比测试 | ❌ **待验证** 🔴 |

### 5. 配置灵活性

| # | 功能 | 预期结果 | 验证方法 | 状态 |
|---|------|---------|---------|------|
| 5.1 | **规则开关** | 可单独启用/禁用规则 | 修改配置 | ⚠️ 部分验证 |
| 5.2 | **severity 模式** | strict/normal/loose | 修改配置 | ❌ **待验证** |
| 5.3 | **排除路径** | 忽略指定目录 | 修改配置 | ⚠️ 部分验证 |
| 5.4 | **性能预算自定义** | 调整大小限制 | 修改配置 | ⚠️ 部分验证 |

---

## 🎯 优先级验证顺序

### P0 - 核心功能（必须验证）

1. ✅ **代码规范检查** - 已完成
2. ✅ **性能文件大小检查** - 已完成
3. ❌ **构建前后文件对比** - 待执行 🔴
4. ❌ **HTML 报告生成** - 待执行 🔴
5. ❌ **实际构建中断测试** - 待执行 🔴

### P1 - 工作流功能（重要）

6. ❌ **增量 vs 全量模式对比** - 待执行
7. ❌ **文件缓存机制** - 待执行
8. ❌ **Git Hooks 集成** - 待执行

### P2 - 配置功能（可选）

9. ❌ **severity 模式切换** - 待执行
10. ❌ **规则开关测试** - 待执行

---

## 📝 详细验证步骤

### 验证 1：构建前后文件对比 🔴

**目标：** 验证插件能检测构建前后文件大小变化

**步骤：**
```bash
# 1. 记录构建前文件状态
cd /Users/chuanjiing.li/Documents/51jbs/project/mall-portal-front
npm run build:dev

# 2. 检查 dist 目录
ls -lh dist/js/*.js dist/css/*.css
du -sh dist/

# 3. 验证报告中是否包含构建对比
cat spec-report.html  # 查找 "构建前后对比" 章节
```

**预期结果：**
- ✅ 报告显示构建前后文件大小对比
- ✅ 标记异常增大的文件（> 20%）
- ✅ 提供优化建议

---

### 验证 2：HTML 报告生成 🔴

**目标：** 验证插件生成完整的 HTML 报告

**步骤：**
```bash
# 1. 运行构建
cd /Users/chuanjiing.li/Documents/51jbs/project/mall-portal-front
npm run build:dev

# 2. 检查报告文件
ls -lh spec-report-v2.html
open spec-report-v2.html

# 3. 验证报告内容
# - 问题统计
# - 详细问题列表
# - 构建前后对比
# - 性能指标
# - 优化建议
```

**预期结果：**
- ✅ 生成 HTML 报告文件
- ✅ 包含所有检查结果
- ✅ 可视化数据展示
- ✅ 提供修复建议

---

### 验证 3：构建中断测试 🔴

**目标：** 验证发现错误时构建是否正确中断

**步骤：**
```bash
# 1. 配置严格模式
# spec-plugin.config.js
severity: 'strict'

# 2. 运行构建
npm run build:dev

# 3. 检查退出码
echo $?  # 应该是 1（失败）

# 4. 验证错误信息
# 应显示具体错误并中断构建
```

**预期结果：**
- ✅ 发现错误时构建中断
- ✅ 返回非零退出码
- ✅ 显示详细错误信息
- ✅ 仅警告时继续构建

---

### 验证 4：增量 vs 全量模式 🔴

**目标：** 验证两种检查模式的差异

**步骤：**
```bash
# 测试 1: 增量模式
mode: 'incremental'
# 只检查 Git 变更文件（约 23 个）

# 测试 2: 全量模式  
mode: 'full'
# 检查所有源文件（约 633 个）

# 对比检查时间和结果
```

**预期结果：**
- ✅ 增量模式只检查变更文件
- ✅ 全量模式检查所有文件
- ✅ 增量模式速度更快
- ✅ 结果准确一致

---

### 验证 5：文件缓存机制 🔴

**目标：** 验证缓存能提升检查速度

**步骤：**
```bash
# 1. 第一次构建（无缓存）
rm -rf .spec-cache
time npm run build:dev
# 记录时间 T1

# 2. 第二次构建（有缓存）
time npm run build:dev
# 记录时间 T2

# 3. 修改一个文件后构建
echo "// test" >> src/main.js
time npm run build:dev
# 记录时间 T3

# 4. 对比时间
# T2 应该远小于 T1（缓存生效）
# T3 应该略大于 T2（部分重新检查）
```

**预期结果：**
- ✅ 缓存后速度提升明显（2-10倍）
- ✅ 文件变更后重新检查
- ✅ 缓存文件存储在 .spec-cache/
- ✅ 缓存有效性验证正确

---

### 验证 6：Git Hooks 集成 🔴

**目标：** 验证 pre-commit hook 自动检查

**步骤：**
```bash
# 1. 安装 Git Hooks
cd /Users/chuanjiing.li/Documents/51jbs/project/mall-portal-front
node ../fe-efficiency/packages/webpack-spec-plugin/scripts/install-hooks.js

# 2. 验证 hook 文件
cat .git/hooks/pre-commit
ls -la .git/hooks/pre-commit  # 应该有执行权限

# 3. 测试 hook
echo "// test" >> src/test.js
git add src/test.js
git commit -m "test: verify pre-commit hook"

# 4. 验证行为
# 应该自动运行规范检查
# 有错误时阻止提交
```

**预期结果：**
- ✅ 成功安装 pre-commit hook
- ✅ 提交前自动运行检查
- ✅ 有错误时阻止提交
- ✅ 无错误时允许提交

---

### 验证 7：Severity 模式切换

**目标：** 验证不同严格程度的行为

**配置对比：**

```javascript
// strict - 严格模式
{ severity: 'strict' }
// - 所有警告视为错误
// - 任何问题都中断构建

// normal - 正常模式（默认）
{ severity: 'normal' }
// - 错误中断构建
// - 警告继续构建

// loose - 宽松模式
{ severity: 'loose' }
// - 仅报告问题
// - 不中断构建
```

**预期结果：**
- ✅ strict 模式：警告也中断构建
- ✅ normal 模式：仅错误中断
- ✅ loose 模式：不中断构建

---

## 📊 验证结果记录表

| 验证项 | 状态 | 发现问题 | 备注 |
|-------|------|---------|------|
| 代码规范检查 | ✅ 通过 | 19 个 | 正常工作 |
| 性能文件大小 | ✅ 通过 | 9 个 | 发现超大图片 |
| 构建前后对比 | ❌ 待测 | - | 核心功能 |
| HTML 报告 | ❌ 待测 | - | 核心功能 |
| 构建中断 | ❌ 待测 | - | 核心功能 |
| 缓存机制 | ❌ 待测 | - | 性能优化 |
| Git Hooks | ❌ 待测 | - | 工作流集成 |
| Severity 模式 | ❌ 待测 | - | 配置灵活性 |

---

## 🎯 验证成功标准

### 功能完整性（80%）

- ✅ 所有核心检查功能正常工作
- ✅ 性能检查发现真实问题
- ✅ 报告生成完整准确
- ✅ 构建集成流畅

### 准确性（100%）

- ✅ 无误报（所有问题都是真实的）
- ✅ 无漏报（关键问题都能发现）
- ✅ 分类准确（错误/警告级别正确）

### 性能（达标）

- ✅ 增量检查速度快（< 10秒）
- ✅ 缓存生效（速度提升 2-10倍）
- ✅ 全量检查可接受（< 60秒）

### 用户体验（良好）

- ✅ 错误信息清晰
- ✅ 报告易读易懂
- ✅ 修复建议实用
- ✅ 配置简单灵活

---

## 🚀 下一步行动

### 立即执行（P0）

1. **运行完整构建测试** - 验证构建前后对比
2. **检查 HTML 报告** - 验证报告完整性
3. **测试构建中断** - 验证错误处理

### 后续执行（P1）

4. **测试缓存机制** - 验证性能优化
5. **安装 Git Hooks** - 验证工作流集成
6. **测试不同模式** - 验证配置灵活性

---

## 📝 验证报告模板

```markdown
# 功能验证报告

## 功能：[功能名称]

**验证日期：** YYYY-MM-DD
**验证人员：** Chuanjing Li
**项目：** mall-portal-front

### 测试步骤
1. ...
2. ...

### 预期结果
- ...

### 实际结果
- ...

### 结论
- ✅ 通过 / ❌ 失败 / ⚠️ 部分通过

### 发现问题
- ...

### 建议改进
- ...
```

---

**文档创建时间：** 2025-12-15  
**下一步：** 执行核心功能验证
