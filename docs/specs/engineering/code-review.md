# Code Review 规范

## 审查目标和原则

### Code Review 目标
```bash
# ✅ Code Review 的主要目标
# 1. 提高代码质量
# 2. 知识共享和团队学习
# 3. 统一编码规范
# 4. 发现潜在问题
# 5. 确保可维护性
```

### 审查原则
```markdown
## ✅ 推荐：Code Review 原则

### 建设性反馈
- 专注于代码而非个人
- 提供具体的改进建议
- 解释为什么需要修改
- 认可好的实现

### 质量优先
- 关注功能正确性
- 检查代码可读性
- 评估性能影响
- 考虑可维护性

### 效率平衡
- 避免过度审查
- 重点审查核心逻辑
- 合理分配审查时间
- 及时提供反馈
```

## 审查检查清单

### 代码质量检查
```markdown
## ✅ 代码质量检查清单

### 命名规范
- [ ] 变量、函数、类名是否具有描述性？
- [ ] 命名是否遵循团队约定？
- [ ] 是否避免了缩写和拼音？

### 代码结构
- [ ] 函数是否职责单一？
- [ ] 类的设计是否合理？
- [ ] 是否存在重复代码？
- [ ] 代码层次是否清晰？

### 错误处理
- [ ] 是否处理了可能的异常情况？
- [ ] 错误信息是否友好且有用？
- [ ] 是否有适当的日志记录？
- [ ] 边界条件是否考虑周全？

### 性能考量
- [ ] 是否存在性能瓶颈？
- [ ] 循环和递归是否合理？
- [ ] 是否有不必要的计算？
- [ ] 内存使用是否优化？
```

### 安全性检查
```markdown
## ✅ 安全性检查清单

### 输入验证
- [ ] 用户输入是否进行了验证？
- [ ] 是否防止了 SQL 注入？
- [ ] 是否处理了 XSS 攻击？
- [ ] 文件上传是否有限制？

### 权限控制
- [ ] 是否实现了适当的权限检查？
- [ ] 敏感操作是否有二次确认？
- [ ] API 接口是否有身份验证？
- [ ] 是否遵循最小权限原则？

### 数据保护
- [ ] 敏感信息是否加密存储？
- [ ] 日志中是否避免了敏感信息？
- [ ] 是否使用了安全的随机数生成？
- [ ] 密钥管理是否安全？
```

## 审查流程规范

### 审查前准备
```markdown
## ✅ 审查前准备工作

### 提交者责任
1. 确保代码通过所有自动化检查
   - Lint 检查
   - 单元测试
   - 类型检查

2. 提供清晰的 PR 描述
   - 问题背景和解决方案
   - 测试方案
   - 相关文档更新

3. 保持合理的变更规模
   - 单个 PR 不超过 400 行新增代码
   - 功能相对独立完整
   - 避免混合不相关的变更

### 审查者责任
1. 及时响应审查请求
   - 24 小时内开始审查
   - 复杂 PR 可申请延期

2. 全面理解变更内容
   - 阅读相关 issue
   - 理解业务背景
   - 查看测试用例
```

### 审查过程中
```markdown
## ✅ 审查过程规范

### 审查技巧
1. 从整体到细节
   - 先看设计思路是否合理
   - 再看具体实现是否正确
   - 最后关注代码细节

2. 关注关键区域
   - 核心业务逻辑
   - 数据库操作
   - 外部接口调用
   - 安全相关代码

3. 提供具体建议
   ```
   # ❌ 不好的评论
   这里写的不好
   
   # ✅ 好的评论
   这里的循环可能会有性能问题，建议考虑使用 Map 来优化查找效率：
   
   const userMap = new Map(users.map(user => [user.id, user]));
   const targetUser = userMap.get(targetId);
   ```

### 评论分级
- **Must Fix（必须修改）**：严重影响功能、安全或可维护性的问题
- **Should Fix（建议修改）**：改善代码质量的建议
- **Could Fix（可选修改）**：锦上添花的优化建议
- **Question（疑问）**：需要澄清的设计决策
```

## 审查标准规范

### JavaScript/TypeScript 审查标准
```markdown
## ✅ JavaScript/TypeScript 审查标准

### 类型安全
- [ ] 是否充分利用 TypeScript 类型系统？
- [ ] 函数参数和返回值是否有明确类型？
- [ ] 泛型使用是否合理？
- [ ] any 类型使用是否必要？

### 异步编程
- [ ] async/await 使用是否恰当？
- [ ] Promise 链是否处理了错误？
- [ ] 是否避免了回调地狱？
- [ ] 并发操作是否合理控制？

### 函数式编程
- [ ] 纯函数使用是否合适？
- [ ] 数组方法使用是否得当？
- [ ] 是否避免了副作用？
- [ ] 函数组合是否清晰？
```

### Vue 组件审查标准
```markdown
## ✅ Vue 组件审查标准

### 组件设计
- [ ] 组件是否职责单一？
- [ ] Props 定义是否完整且有验证？
- [ ] 事件命名是否语义化？
- [ ] 插槽使用是否合理？

### 性能优化
- [ ] 是否使用了必要的缓存（computed、memo）？
- [ ] 列表渲染是否使用了 key？
- [ ] 大组件是否实现了懒加载？
- [ ] 是否避免了不必要的重渲染？

### 可维护性
- [ ] 组件文档是否完整？
- [ ] 代码注释是否清晰？
- [ ] 样式是否作用域隔离？
- [ ] 测试用例是否覆盖全面？
```

## 审查工具和配置

### 自动化审查工具
```javascript
// ✅ 推荐：集成自动化审查工具
// package.json
{
  "scripts": {
    "review": "npm run lint && npm run type-check && npm run test",
    "review:security": "npm audit && npx eslint . --ext .js,.ts,.vue --rule 'security/detect-object-injection: error'"
  }
}

// .github/workflows/code-review.yml
name: Code Review
on: [pull_request]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      
      - name: Setup Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '16'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Run linters
        run: npm run lint
        
      - name: Type checking
        run: npm run type-check
        
      - name: Run tests
        run: npm run test
        
      - name: Security audit
        run: npm audit
```

### 审查模板
```markdown
## ✅ Code Review 模板

### 总体评价
[简要评价本次提交的整体质量]

### 亮点
- [列出做得好的地方]

### 改进建议
#### 必须修改 (Must Fix)
1. [具体问题和修改建议]

#### 建议修改 (Should Fix)
1. [改进建议]

#### 可选优化 (Could Fix)
1. [可选的优化建议]

### 测试建议
- [测试覆盖情况评价]
- [测试用例改进建议]

### 文档建议
- [文档完整性评价]
- [文档改进建议]
```

## 团队协作规范

### 审查文化
```markdown
## ✅ 建立良好的审查文化

### 积极态度
- 鼓励提问和讨论
- 分享知识和经验
- 互相学习和成长
- 保持开放心态

### 沟通技巧
```
// ❌ 避免的沟通方式
这个写得太烂了，重写！

// ✅ 推荐的沟通方式
这个地方的逻辑可以优化一下，建议考虑使用策略模式来处理不同的情况，这样代码会更加清晰和可维护。
```

### 持续改进
- 定期回顾审查标准
- 收集团队反馈
- 更新最佳实践
- 分享典型案例
```

### 审查效率优化
```markdown
## ✅ 提高审查效率的方法

### 时间管理
- 每天固定时间进行审查
- 一次专注审查一个 PR
- 复杂 PR 分段审查
- 及时回应讨论

### 工具辅助
- 使用 IDE 的代码对比功能
- 利用 Git blame 查看历史
- 参考相关文档和规范
- 使用代码片段快速回复
```

## 常见问题和解决方案

### 审查争议处理
```markdown
## ✅ 处理审查争议

### 解决策略
1. 理解不同观点
   - 倾听对方的理由
   - 分析利弊得失
   - 寻找共同目标

2. 技术讨论
   - 提供数据支撑观点
   - 引用权威资料
   - 进行原型验证

3. 决策机制
   - 团队讨论达成共识
   - 技术负责人最终决定
   - 记录决策原因
```

### 审查质量保证
```markdown
## ✅ 保证审查质量

### 审查者能力提升
- 定期技术分享
- 审查案例复盘
- 最佳实践学习
- 跨团队交流

### 审查过程监督
- 审查统计和分析
- 质量趋势监控
- 问题根源分析
- 持续流程优化
```